# **ä¸ªäººè¯¾è¡¨ç³»ç»Ÿ - åç«¯æ¶æ„æ–‡æ¡£ (v3.0)**

> **æ–‡æ¡£ç‰ˆæœ¬**: v3.0  
> **æ›´æ–°æ—¥æœŸ**: 2025 å¹´ 7 æœˆ 1 æ—¥  
> **æŠ€æœ¯æ ˆ**: Spring Boot 3.5.3 + MyBatis + MySQL 8.0+  

---

## **1. é¡¹ç›®æ¶æ„æ¦‚è§ˆ**

### **1.1 æŠ€æœ¯é€‰å‹**

| åˆ†å±‚         | æŠ€æœ¯æ ˆ       | ç‰ˆæœ¬   | è¯´æ˜                     |
| ------------ | ------------ | ------ | ------------------------ |
| **æ¡†æ¶æ ¸å¿ƒ** | Spring Boot  | 3.5.3  | å¾®æœåŠ¡æ¡†æ¶ï¼Œè‡ªåŠ¨é…ç½®     |
| **æ•°æ®è®¿é—®** | MyBatis      | æœ€æ–°ç‰ˆ | SQL æ˜ å°„æ¡†æ¶ï¼Œæ³¨è§£å¼å¼€å‘ |
| **æ•°æ®åº“**   | MySQL        | 8.0+   | å…³ç³»å‹æ•°æ®åº“             |
| **å®‰å…¨è®¤è¯** | JWT + BCrypt | -      | æ— çŠ¶æ€è®¤è¯ + å¯†ç åŠ å¯†    |
| **æ–‡æ¡£ç”Ÿæˆ** | Apache POI   | æœ€æ–°ç‰ˆ | Excel æ–‡ä»¶å¤„ç†           |
| **æ—¥å¿—ç®¡ç†** | Logback      | -      | ç»“æ„åŒ–æ—¥å¿—è¾“å‡º           |
| **æ„å»ºå·¥å…·** | Maven        | 3.6+   | ä¾èµ–ç®¡ç†ä¸é¡¹ç›®æ„å»º       |

### **1.2 æ¶æ„è®¾è®¡åŸåˆ™**

- **åˆ†å±‚æ¶æ„**: Controller â†’ Service â†’ Mapper â†’ Database
- **ä¾èµ–æ³¨å…¥**: åŸºäº Spring IOC å®¹å™¨
- **äº‹åŠ¡ç®¡ç†**: å£°æ˜å¼äº‹åŠ¡ (@Transactional)
- **å¼‚å¸¸å¤„ç†**: ç»Ÿä¸€å¼‚å¸¸å¤„ç†ä¸å“åº”æ ¼å¼
- **æƒé™æ§åˆ¶**: JWT Token + æ‹¦æˆªå™¨
- **æ•°æ®éªŒè¯**: å‚æ•°æ ¡éªŒ + ä¸šåŠ¡è§„åˆ™éªŒè¯

---

## **2. ç›®å½•ç»“æ„è¯¦è§£**

```
back-end/
â”œâ”€â”€ .mvn/                           # Maven Wrapper é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main/
â”‚   â”‚   â”œâ”€â”€ java/com/re0hg/backend/
â”‚   â”‚   â”‚   â”œâ”€â”€ config/             # âœ… é…ç½®ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ WebConfig.java           # Webé…ç½®(CORS, æ‹¦æˆªå™¨)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ (SecurityConfig.java)    # é¢„ç•™å®‰å…¨é…ç½®
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ controller/         # âœ… æ§åˆ¶å™¨å±‚ (REST API)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ LoginController.java     # ç”¨æˆ·ç™»å½•è®¤è¯
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ RegisterController.java  # ç”¨æˆ·æ³¨å†Œ
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TermController.java      # å­¦æœŸç®¡ç† CRUD
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CourseController.java    # è¯¾ç¨‹ç®¡ç† + Excelå¯¼å…¥
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserController.java      # ç”¨æˆ·åŸºç¡€æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ AdminController.java     # ç®¡ç†å‘˜åŠŸèƒ½æ¥å£
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ dto/                # âœ… æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CourseDTO.java           # è¯¾ç¨‹æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ExcelImportResultDTO.java # Excelå¯¼å…¥ç»“æœ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginRequest.java        # ç™»å½•è¯·æ±‚å°è£…
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ exception/          # ğŸ”„ å¼‚å¸¸å¤„ç† (é¢„ç•™)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ GlobalExceptionHandler.java
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ filter/             # âœ… è¿‡æ»¤å™¨ (å¤‡ç”¨æ–¹æ¡ˆ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginCheckFilter.java    # JWTè®¤è¯è¿‡æ»¤å™¨
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ interceptor/        # âœ… æ‹¦æˆªå™¨ (ä¸»è¦æ–¹æ¡ˆ)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginCheckInterceptor.java # JWTè®¤è¯æ‹¦æˆªå™¨
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ mapper/             # âœ… æ•°æ®è®¿é—®å±‚ (MyBatis)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserMapper.java          # ç”¨æˆ·æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TermMapper.java          # å­¦æœŸæ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CourseMapper.java        # è¯¾ç¨‹æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ScheduleEntryMapper.java # æ’ç¨‹æ•°æ®è®¿é—®
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ pojo/               # âœ… å®ä½“ç±» (JPA + MyBatis)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ User.java                # ç”¨æˆ·å®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Term.java                # å­¦æœŸå®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Course.java              # è¯¾ç¨‹å®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ScheduleEntry.java       # æ’ç¨‹å®ä½“
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ PageBean.java            # åˆ†é¡µå°è£…
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ Result.java              # ç»Ÿä¸€å“åº”ç»“æ„
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ LoginRequest.java        # ç™»å½•è¯·æ±‚æ¨¡å‹
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ service/            # âœ… ä¸šåŠ¡é€»è¾‘å±‚
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ impl/                    # ä¸šåŠ¡é€»è¾‘å®ç°
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserServiceimpl.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TermServiceimpl.java
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CourseServiceimpl.java
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ExcelImportServiceImpl.java
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ UserService.java         # ç”¨æˆ·ä¸šåŠ¡æ¥å£
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ TermService.java         # å­¦æœŸä¸šåŠ¡æ¥å£
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ CourseService.java       # è¯¾ç¨‹ä¸šåŠ¡æ¥å£
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ExcelImportService.java  # Excelå¯¼å…¥ä¸šåŠ¡æ¥å£
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ utils/              # âœ… å·¥å…·ç±»
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ JwtUtils.java            # JWTç”Ÿæˆä¸æ ¡éªŒ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ExcelUtils.java          # Excelæ–‡ä»¶å¤„ç†å·¥å…·
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ BackEndApplication.java      # âœ… Spring Boot å¯åŠ¨ç±»
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ resources/
â”‚   â”‚       â””â”€â”€ application.yml              # âœ… åº”ç”¨é…ç½®æ–‡ä»¶
â”‚   â”‚
â”‚   â””â”€â”€ test/                               # âœ… æµ‹è¯•ä»£ç 
â”‚       â””â”€â”€ java/com/re0hg/backend/
â”‚           â”œâ”€â”€ BackEndApplicationTests.java # å¯åŠ¨æµ‹è¯•
â”‚           â””â”€â”€ CourseServiceTest.java       # ä¸šåŠ¡é€»è¾‘æµ‹è¯•
â”‚
â”œâ”€â”€ target/                                 # Mavenæ„å»ºè¾“å‡º
â”œâ”€â”€ mvnw & mvnw.cmd                        # Maven Wrapperè„šæœ¬
â””â”€â”€ pom.xml                                # âœ… Mavené¡¹ç›®é…ç½®
```

---

## **3. æ ¸å¿ƒå±‚æ¬¡æ¶æ„è®¾è®¡**

### **3.1 æ§åˆ¶å™¨å±‚ (Controller Layer)**

#### **èŒè´£**: æ¥æ”¶ HTTP è¯·æ±‚ï¼Œå‚æ•°éªŒè¯ï¼Œè°ƒç”¨ä¸šåŠ¡å±‚ï¼Œè¿”å›å“åº”

```java
@RestController
@RequestMapping("/api")
@Slf4j
public class CourseController {
    @Autowired
    private CourseService courseService;

    @PostMapping("/courses")
    public Result createCourse(@RequestBody CourseDTO courseDTO, HttpServletRequest request) {
        Long userId = getCurrentUserId(request);
        Course createdCourse = courseService.createCourse(course, userId);
        return Result.success(201, "è¯¾ç¨‹åˆ›å»ºæˆåŠŸ", createdCourse);
    }
}
```

#### **ä¸»è¦æ§åˆ¶å™¨**:

- **[`LoginController.java`](back-end/src/main/java/com/re0hg/backend/controller/LoginController.java)**: ç”¨æˆ·è®¤è¯æ¥å£
- **[`RegisterController.java`](back-end/src/main/java/com/re0hg/backend/controller/RegisterController.java)**: ç”¨æˆ·æ³¨å†Œæ¥å£
- **[`TermController.java`](back-end/src/main/java/com/re0hg/backend/controller/TermController.java)**: å­¦æœŸç®¡ç† CRUD
- **[`CourseController.java`](back-end/src/main/java/com/re0hg/backend/controller/CourseController.java)**: è¯¾ç¨‹ç®¡ç† + Excel å¯¼å…¥
- **[`AdminController.java`](back-end/src/main/java/com/re0hg/backend/controller/AdminController.java)**: ç®¡ç†å‘˜åŠŸèƒ½ (ç”¨æˆ·ç®¡ç†)

### **3.2 ä¸šåŠ¡é€»è¾‘å±‚ (Service Layer)**

#### **èŒè´£**: æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œäº‹åŠ¡ç®¡ç†ï¼Œæ•°æ®è½¬æ¢

```java
@Service
@Transactional
public class CourseServiceimpl implements CourseService {
    @Autowired
    private CourseMapper courseMapper;

    @Override
    public Course createCourse(Course course, Long userId) {
        // 1. éªŒè¯å­¦æœŸæƒé™
        boolean isOwner = courseMapper.isTermOwnedByUser(termId, userId);
        if (!isOwner) {
            throw new RuntimeException("æ— æƒé™æ“ä½œæ­¤å­¦æœŸæˆ–å­¦æœŸä¸å­˜åœ¨");
        }

        // 2. åˆ›å»ºè¯¾ç¨‹
        courseMapper.createCourse(course, userId);

        // 3. åˆ›å»ºæ’ç¨‹ä¿¡æ¯
        for (ScheduleEntry entry : course.getScheduleEntries()) {
            entry.setCourse(course);
            scheduleEntryMapper.createScheduleEntry(entry);
        }

        return course;
    }
}
```

#### **ä¸»è¦æœåŠ¡ç±»**:

- **[`UserServiceimpl.java`](back-end/src/main/java/com/re0hg/backend/service/impl/UserServiceimpl.java)**: ç”¨æˆ·ç®¡ç†ä¸šåŠ¡é€»è¾‘
- **[`TermServiceimpl.java`](back-end/src/main/java/com/re0hg/backend/service/impl/TermServiceimpl.java)**: å­¦æœŸç®¡ç†ä¸šåŠ¡é€»è¾‘
- **[`CourseServiceimpl.java`](back-end/src/main/java/com/re0hg/backend/service/impl/CourseServiceimpl.java)**: è¯¾ç¨‹ç®¡ç†ä¸šåŠ¡é€»è¾‘
- **[`ExcelImportServiceImpl.java`](back-end/src/main/java/com/re0hg/backend/service/impl/ExcelImportServiceImpl.java)**: Excel å¯¼å…¥ä¸šåŠ¡é€»è¾‘

### **3.3 æ•°æ®è®¿é—®å±‚ (Mapper Layer)**

#### **èŒè´£**: æ•°æ®åº“æ“ä½œï¼ŒSQL æ˜ å°„ï¼Œç»“æœé›†å¤„ç†

```java
@Mapper
public interface CourseMapper {
    @Insert("INSERT INTO courses (name, teachers, main_teacher_email, course_group_chat_id, tag, note, term_id, user_id) " +
            "VALUES (#{course.name}, #{course.teachers}, #{course.mainTeacherEmail}, #{course.courseGroupChatId}, " +
            "#{course.tag}, #{course.note}, #{course.term.id}, #{userId})")
    @Options(useGeneratedKeys = true, keyProperty = "course.id")
    int createCourse(@Param("course") Course course, @Param("userId") Long userId);

    @Select("SELECT * FROM courses WHERE term_id = #{termId} ORDER BY id DESC LIMIT #{offset}, #{pageSize}")
    List<Course> findByTermIdWithPagination(@Param("termId") Long termId,
                                          @Param("offset") int offset,
                                          @Param("pageSize") int pageSize);
}
```

#### **ä¸»è¦ Mapper æ¥å£**:

- **[`UserMapper.java`](back-end/src/main/java/com/re0hg/backend/mapper/UserMapper.java)**: ç”¨æˆ·æ•°æ®è®¿é—®
- **[`TermMapper.java`](back-end/src/main/java/com/re0hg/backend/mapper/TermMapper.java)**: å­¦æœŸæ•°æ®è®¿é—®
- **[`CourseMapper.java`](back-end/src/main/java/com/re0hg/backend/mapper/CourseMapper.java)**: è¯¾ç¨‹æ•°æ®è®¿é—®
- **[`ScheduleEntryMapper.java`](back-end/src/main/java/com/re0hg/backend/mapper/ScheduleEntryMapper.java)**: æ’ç¨‹æ•°æ®è®¿é—®

### **3.4 å®ä½“å±‚ (Entity Layer)**

#### **èŒè´£**: æ•°æ®æ¨¡å‹å®šä¹‰ï¼ŒJPA æ³¨è§£é…ç½®ï¼Œå…³ç³»æ˜ å°„

```java
@Data
@Entity
@Table(name = "courses")
public class Course {
    @Id
    @GeneratedValue(strategy = GenerationType.IDENTITY)
    private Long id;

    @Column(name = "name", nullable = false, length = 100)
    private String name;

    @Column(length = 255)
    private String teachers;

    private Integer tag; // 0ä»£è¡¨é€‰ä¿®ï¼Œ1ä»£è¡¨å¿…ä¿®

    @CreationTimestamp
    @Column(name = "created_at", nullable = false, updatable = false)
    private LocalDateTime createdAt;

    @ManyToOne(fetch = FetchType.LAZY)
    @JoinColumn(name = "term_id")
    private Term term;

    @Transient // ä¸æŒä¹…åŒ–åˆ°æ•°æ®åº“
    private List<ScheduleEntry> scheduleEntries;
}
```

#### **ä¸»è¦å®ä½“ç±»**:

- **[`User.java`](back-end/src/main/java/com/re0hg/backend/pojo/User.java)**: ç”¨æˆ·å®ä½“
- **[`Term.java`](back-end/src/main/java/com/re0hg/backend/pojo/Term.java)**: å­¦æœŸå®ä½“
- **[`Course.java`](back-end/src/main/java/com/re0hg/backend/pojo/Course.java)**: è¯¾ç¨‹å®ä½“
- **[`ScheduleEntry.java`](back-end/src/main/java/com/re0hg/backend/pojo/ScheduleEntry.java)**: æ’ç¨‹å®ä½“

---

## **4. æ ¸å¿ƒåŠŸèƒ½æ¨¡å—è®¾è®¡**

### **4.1 è®¤è¯æˆæƒæ¨¡å—**

#### **JWT è®¤è¯æµç¨‹**:

```java
// 1. ç”¨æˆ·ç™»å½•
@PostMapping("/api/auth/login")
public Result login(@RequestBody LoginRequest loginRequest) {
    // éªŒè¯ç”¨æˆ·åå¯†ç 
    User user = userService.findByUsername(loginRequest.getUsername());

    // ç”ŸæˆJWT Token
    Map<String, Object> claims = new HashMap<>();
    claims.put("id", user.getId());
    claims.put("username", user.getUsername());
    claims.put("role", user.getRole());
    String token = JwtUtils.generateJwt(claims);

    return Result.success(200, "ç™»å½•æˆåŠŸ", Map.of("token", token));
}

// 2. è¯·æ±‚æ‹¦æˆªéªŒè¯
@Component
public class LoginCheckInterceptor implements HandlerInterceptor {
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        String token = request.getHeader("token");
        Claims claims = JwtUtils.parseJWT(token);
        // éªŒè¯é€šè¿‡ï¼Œæ”¾è¡Œè¯·æ±‚
        return true;
    }
}
```

#### **æƒé™æ§åˆ¶ç­–ç•¥**:

- **è·¯å¾„æ’é™¤**: `/api/auth/**` æ— éœ€è®¤è¯
- **Token éªŒè¯**: æ‰€æœ‰å…¶ä»–è¯·æ±‚éœ€è¦æœ‰æ•ˆ JWT
- **ç”¨æˆ·æƒé™**: åŸºäºç”¨æˆ· ID çš„æ•°æ®éš”ç¦»
- **ç®¡ç†å‘˜æƒé™**: ADMIN è§’è‰²çš„ç‰¹æ®ŠåŠŸèƒ½è®¿é—®

### **4.2 è¯¾ç¨‹ç®¡ç†æ¨¡å—**

#### **æ ¸å¿ƒåŠŸèƒ½**:

```java
@Service
public class CourseServiceimpl implements CourseService {
    // åˆ†é¡µæŸ¥è¯¢è¯¾ç¨‹
    public PageBean<Course> getCoursesForTermWithPagination(Long termId, Long userId, int page, int size) {
        // 1. æƒé™éªŒè¯
        boolean isOwner = courseMapper.isTermOwnedByUser(termId, userId);

        // 2. åˆ†é¡µæŸ¥è¯¢
        List<Course> courses = courseMapper.findByTermIdWithPagination(termId, offset, size);

        // 3. å…³è”æŸ¥è¯¢æ’ç¨‹ä¿¡æ¯
        for (Course course : courses) {
            List<ScheduleEntry> scheduleEntries = scheduleEntryMapper.findScheduleEntriesByCourseId(course.getId());
            course.setScheduleEntries(scheduleEntries);
        }

        return new PageBean<>(courses, page, size, totalElements);
    }
}
```

#### **é«˜çº§æœç´¢åŠŸèƒ½**:

- **å¤šæ¡ä»¶ç­›é€‰**: è¯¾ç¨‹åç§°ã€æ•™å¸ˆã€æ ‡ç­¾ã€æ˜ŸæœŸ
- **æ¨¡ç³ŠæŸ¥è¯¢**: LIKE è¯­å¥å®ç°åç§°å’Œæ•™å¸ˆæœç´¢
- **åˆ†é¡µæ”¯æŒ**: å¤§æ•°æ®é‡ä¸‹çš„æ€§èƒ½ä¼˜åŒ–
- **æƒé™éš”ç¦»**: ç”¨æˆ·åªèƒ½æœç´¢è‡ªå·±çš„è¯¾ç¨‹

### **4.3 Excel å¯¼å…¥æ¨¡å—**

#### **å¯¼å…¥æµç¨‹è®¾è®¡**:

```java
@Service
@Transactional
public class ExcelImportServiceImpl implements ExcelImportService {
    public ExcelImportResultDTO importCoursesFromExcel(MultipartFile file, Long termId, Long userId) {
        // 1. æ–‡ä»¶è§£æ
        Workbook workbook = ExcelUtils.getWorkbook(file);
        List<Map<String, Object>> dataList = ExcelUtils.parseExcelData(workbook);

        // 2. æ•°æ®éªŒè¯ä¸è½¬æ¢
        for (Map<String, Object> rowData : dataList) {
            try {
                Course course = processRowData(rowData, termId, userId);
                result.getImportedCourses().add(course);
            } catch (Exception e) {
                result.getErrors().add(new ImportErrorDTO(rowNumber, e.getMessage()));
            }
        }

        return result;
    }
}
```

#### **æ¨¡æ¿ä¸‹è½½åŠŸèƒ½**:

- **åŠ¨æ€ç”Ÿæˆ**: Apache POI åˆ›å»º Excel æ¨¡æ¿
- **æ ‡å‡†æ ¼å¼**: é¢„å®šä¹‰åˆ—å¤´å’Œç¤ºä¾‹æ•°æ®
- **æ–‡ä»¶æµå“åº”**: ç›´æ¥ä¸‹è½½æ— éœ€ä¸´æ—¶æ–‡ä»¶

### **4.4 å­¦æœŸç®¡ç†æ¨¡å—**

#### **çº§è”åˆ é™¤å¤„ç†**:

```java
@Transactional
public boolean deleteTerm(Long termId, Long userId) {
    // 1. è·å–å­¦æœŸä¸‹çš„æ‰€æœ‰è¯¾ç¨‹ID
    List<Long> courseIds = courseMapper.findCourseIdsByTermId(termId);

    // 2. åˆ é™¤æ‰€æœ‰è¯¾ç¨‹çš„æ’ç¨‹ä¿¡æ¯
    for (Long courseId : courseIds) {
        scheduleEntryMapper.deleteScheduleEntriesByCourseId(courseId);
    }

    // 3. åˆ é™¤æ‰€æœ‰è¯¾ç¨‹
    courseMapper.deleteCoursesByTermId(termId);

    // 4. åˆ é™¤å­¦æœŸ
    int rowsAffected = termMapper.delete(termId);
    return rowsAffected > 0;
}
```

---

## **5. æ•°æ®åº“è®¾è®¡ä¸æ˜ å°„**

### **5.1 æ ¸å¿ƒè¡¨ç»“æ„**

```sql
-- ç”¨æˆ·è¡¨
CREATE TABLE users (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    username VARCHAR(50) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    role ENUM('USER', 'ADMIN', 'TRIAL') DEFAULT 'USER',
    is_enabled BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- å­¦æœŸè¡¨
CREATE TABLE terms (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    start_date DATE NOT NULL,
    end_date DATE NOT NULL,
    user_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- è¯¾ç¨‹è¡¨
CREATE TABLE courses (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    name VARCHAR(100) NOT NULL,
    teachers VARCHAR(255),
    main_teacher_email VARCHAR(100),
    course_group_chat_id VARCHAR(50),
    tag INT DEFAULT 1, -- 0:é€‰ä¿® 1:å¿…ä¿®
    note TEXT,
    term_id BIGINT NOT NULL,
    user_id BIGINT NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (term_id) REFERENCES terms(id) ON DELETE CASCADE,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

-- æ’ç¨‹è¡¨
CREATE TABLE schedule_entries (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    location VARCHAR(100),
    day_of_week INT NOT NULL, -- 1-7 (å‘¨ä¸€åˆ°å‘¨æ—¥)
    start_period INT NOT NULL, -- 1-12 (ç¬¬å‡ èŠ‚è¯¾)
    end_period INT NOT NULL,
    start_week INT NOT NULL, -- 1-20 (ç¬¬å‡ å‘¨)
    end_week INT NOT NULL,
    course_id BIGINT NOT NULL,
    FOREIGN KEY (course_id) REFERENCES courses(id) ON DELETE CASCADE
);
```

### **5.2 MyBatis æ³¨è§£æ˜ å°„**

```java
@Mapper
public interface CourseMapper {
    // å¤æ‚æŸ¥è¯¢ï¼šåŠ¨æ€æ¡ä»¶æœç´¢
    @SelectProvider(type = CourseSqlProvider.class, method = "searchCoursesSQL")
    List<Course> searchCourses(@Param("termId") Long termId,
                              @Param("name") String name,
                              @Param("teacher") String teacher,
                              @Param("tag") Integer tag,
                              @Param("dayOfWeek") Integer dayOfWeek,
                              @Param("offset") int offset,
                              @Param("pageSize") int pageSize);

    // æƒé™éªŒè¯ï¼šæ£€æŸ¥è¯¾ç¨‹æ‰€æœ‰æƒ
    @Select("SELECT COUNT(*) > 0 FROM courses c " +
            "JOIN terms t ON c.term_id = t.id " +
            "WHERE c.id = #{courseId} AND t.user_id = #{userId}")
    boolean isCourseOwnedByUser(@Param("courseId") Long courseId, @Param("userId") Long userId);
}
```

---

## **6. é…ç½®ä¸ä¸­é—´ä»¶**

### **6.1 Web é…ç½® (WebConfig.java)**

```java
@Configuration
public class WebConfig implements WebMvcConfigurer {
    @Autowired
    private LoginCheckInterceptor loginCheckInterceptor;

    // æ·»åŠ æ‹¦æˆªå™¨
    @Override
    public void addInterceptors(InterceptorRegistry registry) {
        registry.addInterceptor(loginCheckInterceptor)
                .addPathPatterns("/**")
                .excludePathPatterns("/api/auth/**");
    }

    // CORSé…ç½®
    @Override
    public void addCorsMappings(CorsRegistry registry) {
        registry.addMapping("/**")
                .allowedOriginPatterns("*")
                .allowedMethods("GET", "POST", "PUT", "DELETE", "OPTIONS")
                .allowedHeaders("*")
                .allowCredentials(true);
    }
}
```

### **6.2 åº”ç”¨é…ç½® (application.yml)**

```yaml
server:
  port: 8080

spring:
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://localhost:3306/personal_courses?serverTimezone=UTC&useUnicode=true&characterEncoding=utf8&useSSL=false
    username: ${DB_USERNAME:root}
    password: ${DB_PASSWORD:123456}

  servlet:
    multipart:
      max-file-size: 10MB
      max-request-size: 10MB

mybatis:
  configuration:
    map-underscore-to-camel-case: true
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl

logging:
  level:
    com.re0hg.backend: DEBUG
    root: INFO
```

---

## **7. å·¥å…·ç±»ä¸é€šç”¨ç»„ä»¶**

### **7.1 JWT å·¥å…·ç±» (JwtUtils.java)**

```java
public class JwtUtils {
    private static String signKey = "re0hg";
    private static Long expire = 43200000L; // 12å°æ—¶

    // ç”ŸæˆJWTä»¤ç‰Œ
    public static String generateJwt(Map<String, Object> claims) {
        String jwt = Jwts.builder()
            .addClaims(claims)
            .signWith(SignatureAlgorithm.HS256, signKey)
            .setExpiration(new Date(System.currentTimeMillis() + expire))
            .compact();
        return jwt;
    }

    // è§£æJWTä»¤ç‰Œ
    public static Claims parseJWT(String jwt) {
        Claims claims = Jwts.parser()
            .setSigningKey(signKey)
            .parseClaimsJws(jwt)
            .getBody();
        return claims;
    }
}
```

### **7.2 Excel å·¥å…·ç±» (ExcelUtils.java)**

```java
public class ExcelUtils {
    // åˆ›å»ºExcelæ¨¡æ¿
    public static Workbook createTemplateWorkbook() {
        Workbook workbook = new XSSFWorkbook();
        Sheet sheet = workbook.createSheet("è¯¾ç¨‹ä¿¡æ¯");

        // åˆ›å»ºæ ‡é¢˜è¡Œ
        Row headerRow = sheet.createRow(0);
        String[] headers = {"è¯¾ç¨‹åç§°", "æ•™å¸ˆ", "ä¸»è®²è€å¸ˆé‚®ç®±", "è¯¾ç¨‹ç¾¤å·",
                           "æ ‡ç­¾", "ä¸Šè¯¾åœ°ç‚¹", "æ˜ŸæœŸ", "å¼€å§‹èŠ‚æ¬¡", "ç»“æŸèŠ‚æ¬¡",
                           "å¼€å§‹å‘¨", "ç»“æŸå‘¨", "å¤‡æ³¨"};

        for (int i = 0; i < headers.length; i++) {
            Cell cell = headerRow.createCell(i);
            cell.setCellValue(headers[i]);
        }

        return workbook;
    }

    // è§£æExcelæ•°æ®
    public static List<Map<String, Object>> parseExcelData(Workbook workbook) {
        // å®ç°Excelæ•°æ®è§£æé€»è¾‘
        // è¿”å›è¡Œæ•°æ®çš„Mapåˆ—è¡¨
    }
}
```

### **7.3 ç»Ÿä¸€å“åº”ç»“æ„ (Result.java)**

```java
@Data
public class Result {
    private Integer code;
    private String message;
    private Object data;

    public static Result success(Integer code, String message, Object data) {
        Result result = new Result();
        result.code = code;
        result.message = message;
        result.data = data;
        return result;
    }

    public static Result error(Integer code, String message) {
        Result result = new Result();
        result.code = code;
        result.message = message;
        return result;
    }
}
```

---

## **8. å¼‚å¸¸å¤„ç†ä¸æ—¥å¿—**

### **8.1 å…¨å±€å¼‚å¸¸å¤„ç†**

```java
@RestControllerAdvice
public class GlobalExceptionHandler {

    @ExceptionHandler(RuntimeException.class)
    public Result handleRuntimeException(RuntimeException e) {
        log.error("ä¸šåŠ¡å¼‚å¸¸: ", e);
        return Result.error(400, e.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public Result handleException(Exception e) {
        log.error("ç³»ç»Ÿå¼‚å¸¸: ", e);
        return Result.error(500, "ç³»ç»Ÿå†…éƒ¨é”™è¯¯");
    }
}
```

### **8.2 æ—¥å¿—é…ç½®ç­–ç•¥**

- **DEBUG çº§åˆ«**: å¼€å‘ç¯å¢ƒï¼Œè¯¦ç»†çš„ SQL å’Œå‚æ•°ä¿¡æ¯
- **INFO çº§åˆ«**: ç”Ÿäº§ç¯å¢ƒï¼Œå…³é”®ä¸šåŠ¡æ“ä½œè®°å½•
- **ERROR çº§åˆ«**: å¼‚å¸¸å’Œé”™è¯¯ä¿¡æ¯è®°å½•
- **æ—¥å¿—æ ¼å¼**: æ—¶é—´ + çº§åˆ« + ç±»å + æ¶ˆæ¯å†…å®¹

---

## **9. æ€§èƒ½ä¼˜åŒ–ä¸æœ€ä½³å®è·µ**

### **9.1 æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–**

```sql
-- å…³é”®ç´¢å¼•è®¾è®¡
CREATE INDEX idx_courses_term_user ON courses(term_id, user_id);
CREATE INDEX idx_schedule_entries_course ON schedule_entries(course_id);
CREATE INDEX idx_terms_user ON terms(user_id);
CREATE INDEX idx_users_username ON users(username);
```

### **9.2 æŸ¥è¯¢ä¼˜åŒ–ç­–ç•¥**

- **åˆ†é¡µæŸ¥è¯¢**: ä½¿ç”¨ LIMIT é¿å…å…¨è¡¨æ‰«æ
- **å»¶è¿ŸåŠ è½½**: JPA LAZY ç­–ç•¥å‡å°‘ä¸å¿…è¦çš„å…³è”æŸ¥è¯¢
- **æ‰¹é‡æ“ä½œ**: äº‹åŠ¡å†…æ‰¹é‡å¤„ç†å‡å°‘æ•°æ®åº“äº¤äº’
- **ç¼“å­˜ç­–ç•¥**: å¯¹äºç”¨æˆ·ä¿¡æ¯ç­‰ç›¸å¯¹é™æ€çš„æ•°æ®è€ƒè™‘ç¼“å­˜

### **9.3 äº‹åŠ¡ç®¡ç†æœ€ä½³å®è·µ**

```java
@Service
@Transactional(rollbackFor = Exception.class)
public class CourseServiceimpl implements CourseService {
    // æ˜¾å¼äº‹åŠ¡è¾¹ç•Œï¼Œå¼‚å¸¸è‡ªåŠ¨å›æ»š
    public Course createCourse(Course course, Long userId) {
        // åŸå­æ€§æ“ä½œï¼šè¯¾ç¨‹åˆ›å»º + æ’ç¨‹åˆ›å»º
    }
}
```
